app.register.controller("activityGYYController",function($rootScope,$scope,httpRequest,dataStringify,signSha1,analytics,$location){$scope.isShowNavbar=!1,$scope.isApp=isApp($location),$scope.isShowNavbar=$scope.isApp?!1:!0;var link="http://goeasy.yhiker.com/#/activity/beautyLife?source=3&sharedTo=",imgUrl="http://goeasy.yhiker.com/image/activity/gyy/1.jpg",title="购轻松台湾",desc="郭元益",createNonceStr=function(){return Math.random().toString(36).substr(2,15)},createTimestamp=function(){return parseInt((new Date).getTime()/1e3)+""},raw=function(args){var keys=Object.keys(args);keys=keys.sort();var newArgs={};keys.forEach(function(key){newArgs[key.toLowerCase()]=args[key]});var string="";for(var k in newArgs)string+="&"+k+"="+newArgs[k];return string=string.substr(1)},nonceStr=createNonceStr(),timestamp=createTimestamp(),weixinSdkConfig=function(){$scope.ticket=getWxSdkToken().ticket;var ret={jsapi_ticket:getWxSdkToken().ticket,nonceStr:nonceStr,timestamp:timestamp,url:$location.absUrl().split("#")[0]},string=raw(ret),signature=signSha1(string),config={appId:easybuy.weixinAppId,timestamp:timestamp,nonceStr:nonceStr,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"],signature:signature};$(document).ready(function(){wx.config(config),wx.ready(function(){wx.onMenuShareTimeline({title:desc,link:link+"1",imgUrl:imgUrl,success:function(){$scope.fadeOutShare();{var tokenInfo=getToken();"platform=all&token="+tokenInfo.token}},cancel:function(){}}),wx.onMenuShareAppMessage({title:title,desc:desc,link:link+"2",imgUrl:imgUrl,type:"link",dataUrl:"",success:function(){},cancel:function(){}})}),wx.error(function(res){alertWarning(JSON.stringify(res))})})};if(easybuy.isWechat)if(!getWxSdkToken()||getWxSdkToken()&&!getWxSdkToken().ticket){var data="platform=all";httpRequest.APIPOST("/wx/data?platform=all",null,{"content-type":"application/x-www-form-urlencoded"}).then(function(result){if(result&&result.code==statusCode.Success){var data=result.result;setWxSdkToken({accessToken:data.access_token,ticket:data.ticket}),weixinSdkConfig()}else alert(result.msg)})}else weixinSdkConfig();$scope.goTo=function(index){for(var g=[],i=0;i<$scope.products.length;i++)g.push($scope.products[i].goodsId);index<=g.length&&($scope.isApp?window.location.href=easybuy.appActivity+"?action=1&goodId="+g[index-1]:$location.path("/product/"+g[index-1]+"/1"))},$scope.goProduct=function(id){return id?void($scope.isApp?window.location.href=easybuy.appActivity+"?action=1&goodId="+id:$location.path("/product/"+id+"/1")):void alertWarning("该商品已经下架，请选择其他商品购买^_^")};var appToken="";if(forApp.loginSuccess=function(data){appToken=data},$scope.buyNow=function(){if($scope.isApp){var actId="";if(actId=$location.search().activityId instanceof Array?$location.search().activityId[0]:$location.search().activityId,appToken||(appToken=$location.search().token),!appToken)return void(window.location.href=easybuy.appActivity+"?action=4&mustLogin=1&goodId="+$scope.products[0].goodsId+"&name="+$scope.products[0].goodsName+"&smallImg="+$scope.products[0].goodsImg+"&promotePrice="+$scope.products[0].price);var data="platform=all&activityId="+actId+"&token="+appToken+"&goodsId="+$scope.products[0].goodsId;httpRequest.APIPOST("/activity/validate",dataStringify(data),{"content-type":"application/x-www-form-urlencoded"}).then(function(result){return result&&result.code==statusCode.Success?void(window.location.href=easybuy.appActivity+"?action=4&mustLogin=1&goodId="+$scope.products[0].goodsId+"&name="+$scope.products[0].goodsName+"&smallImg="+$scope.products[0].goodsImg+"&promotePrice="+$scope.products[0].price):void alertWarning(result.msg)})}else{var arrButton=["取消","去下载"];openDialog("该活动商品仅支持在购轻松台湾App内预订","",arrButton,null,function(r){r&&($location.path("/downloadApp"),$scope.$apply($location))})}},$scope.more=function(){$scope.isApp?window.location.href=easybuy.appActivity+"?action=5":$location.path("/products")},$scope.shareToFriends=function(){if($scope.isApp)return void(window.location.href=easybuy.appActivity+"?action=3&shareTitle="+title+"&shareText="+desc+"&shareUrl="+link+"&shareImageUrl="+imgUrl);if(easybuy.isWechat){var tokenInfo=getToken();tokenInfo&&tokenInfo.token&&tokenInfo.openId?$scope.fadeInShare():$location.path("/wechatOauth/activity-activityDetail")}else{var arrButton=["确定"];openDialog("请在微信内打开并分享到朋友圈","",arrButton,null,function(r){})}},$scope.shareSuccess=function(){},$scope.back=function(){$location.path("/products")},$scope.fadeOutShare=function(){$("#shareHint").fadeOut()},$scope.fadeInShare=function(){$("#shareHint").fadeIn()},$location.search()){var actId="";actId=$location.search().activityId instanceof Array?$location.search().activityId[0]:$location.search().activityId;var data="platform=all&activityId="+actId;httpRequest.APIPOST("/activity/detail",dataStringify(data),{"content-type":"application/x-www-form-urlencoded"}).then(function(result){if(result&&result.code==statusCode.Success){if($scope.activityInfo=result.result,null==result.result)return void alertExt("该活动已结束，更多精彩活动尽在首页！",function(){$location.path("/"),$scope.$apply($location)});var act=$scope.activityInfo.activity;act.url||(act.url=""),link=act.url.indexOf("?")>0?act.url+"&activityId="+act.id+"&source=3&sharedTo=":act.url+"?activityId="+act.id+"&source=3&sharedTo=",imgUrl=act.img,title=act.name,desc=act.desc,$scope.products=[],$scope.activityInfo&&$scope.activityInfo.fullGiveGoodsList&&($scope.products=$scope.activityInfo.fullGiveGoodsList)}else alert(result.msg+":activity-detail")})}if($location.search()&&$location.search().sharedTo&&$location.search().source){var actId=($location.search(),""),channel=$location.search().sharedTo||1;channel instanceof Array&&(channel=1);{var platform=$location.search().source||"all";$location.search().pageType||""}platform=1==platform?"android":2==platform?"ios":"all",actId=$location.search().activityId instanceof Array?$location.search().activityId[0]:$location.search().activityId;var token="";getToken()&&(token="&token="+getToken().token);var data="activityId="+actId+"&channel="+channel+"&platform="+platform+token;httpRequest.APIPOST("/activity/clickLog",dataStringify(data),{"content-type":"application/x-www-form-urlencoded"}).then(function(result){result&&result.code==statusCode.Success})}else{var platform=$location.search().platform||"all",token=$location.search().token||"",actId="";actId=$location.search().activityId instanceof Array?$location.search().activityId[0]:$location.search().activityId,token?token="&token="+token:getToken()&&(token="&token="+getToken().token);var data="activityId="+actId+"&type=2&platform="+platform+token;httpRequest.APIPOST("/activity/clickLog",dataStringify(data),{"content-type":"application/x-www-form-urlencoded"}).then(function(result){result&&result.code==statusCode.Success})}}),app.register.controller("nationalDayController",function($rootScope,$scope,httpRequest,dataStringify,signSha1,analytics,$location){$scope.isShowNavbar=!1,$scope.isApp=isApp($location),$scope.isShowNavbar=$scope.isApp?!1:!0;var link="http://goeasy.yhiker.com/#/activity/beautyLife?source=3&sharedTo=",imgUrl="http://goeasy.yhiker.com/image/activity/gyy/1.jpg",title="购轻松台湾",desc="国庆",createNonceStr=function(){return Math.random().toString(36).substr(2,15)},createTimestamp=function(){return parseInt((new Date).getTime()/1e3)+""},raw=function(args){var keys=Object.keys(args);keys=keys.sort();var newArgs={};keys.forEach(function(key){newArgs[key.toLowerCase()]=args[key]});var string="";for(var k in newArgs)string+="&"+k+"="+newArgs[k];return string=string.substr(1)},nonceStr=createNonceStr(),timestamp=createTimestamp(),weixinSdkConfig=function(){$scope.ticket=getWxSdkToken().ticket;var ret={jsapi_ticket:getWxSdkToken().ticket,nonceStr:nonceStr,timestamp:timestamp,url:$location.absUrl().split("#")[0]},string=raw(ret),signature=signSha1(string),config={appId:easybuy.weixinAppId,timestamp:timestamp,nonceStr:nonceStr,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"],signature:signature};$(document).ready(function(){wx.config(config),wx.ready(function(){wx.onMenuShareTimeline({title:desc,link:link+"1",imgUrl:imgUrl,success:function(){$scope.fadeOutShare();{var tokenInfo=getToken();"platform=all&token="+tokenInfo.token}},cancel:function(){}}),wx.onMenuShareAppMessage({title:title,desc:desc,link:link+"2",imgUrl:imgUrl,type:"link",dataUrl:"",success:function(){},cancel:function(){}})}),wx.error(function(res){alertWarning(JSON.stringify(res))})})};if(easybuy.isWechat)if(!getWxSdkToken()||getWxSdkToken()&&!getWxSdkToken().ticket){var data="platform=all";httpRequest.APIPOST("/wx/data?platform=all",null,{"content-type":"application/x-www-form-urlencoded"}).then(function(result){if(result&&result.code==statusCode.Success){var data=result.result;setWxSdkToken({accessToken:data.access_token,ticket:data.ticket}),weixinSdkConfig()}else alert(result.msg)})}else weixinSdkConfig();$scope.goTo=function(index){for(var g=[],i=0;i<$scope.products.length;i++)g.push($scope.products[i].goodsId);index<=g.length&&($scope.isApp?window.location.href=easybuy.appActivity+"?action=1&goodId="+g[index-1]:$location.path("/product/"+g[index-1]+"/1"))},$scope.goProduct=function(id){return id?void($scope.isApp?window.location.href=easybuy.appActivity+"?action=1&goodId="+id:$location.path("/product/"+id+"/1")):void alertWarning("该商品已经下架，请选择其他商品购买^_^")};var appToken="";if(forApp.loginSuccess=function(data){appToken=data},$scope.buyNow=function(){if($scope.isApp){var actId="";if(actId=$location.search().activityId instanceof Array?$location.search().activityId[0]:$location.search().activityId,appToken||(appToken=$location.search().token),!appToken)return void(window.location.href=easybuy.appActivity+"?action=4&mustLogin=1&goodId="+$scope.products[0].goodsId+"&name="+$scope.products[0].goodsName+"&smallImg="+$scope.products[0].goodsImg+"&promotePrice="+$scope.products[0].price);var data="platform=all&activityId="+actId+"&token="+appToken+"&goodsId="+$scope.products[0].goodsId;httpRequest.APIPOST("/activity/validate",dataStringify(data),{"content-type":"application/x-www-form-urlencoded"}).then(function(result){return result&&result.code==statusCode.Success?void(window.location.href=easybuy.appActivity+"?action=4&mustLogin=1&goodId="+$scope.products[0].goodsId+"&name="+$scope.products[0].goodsName+"&smallImg="+$scope.products[0].goodsImg+"&promotePrice="+$scope.products[0].price):void alertWarning(result.msg)})}else{var arrButton=["取消","去下载"];openDialog("该活动商品仅支持在购轻松台湾App内预订","",arrButton,null,function(r){r&&($location.path("/downloadApp"),$scope.$apply($location))})}},$scope.more=function(){$scope.isApp?window.location.href=easybuy.appActivity+"?action=5":$location.path("/products")},$scope.shareToFriends=function(){if($scope.isApp)return void(window.location.href=easybuy.appActivity+"?action=3&shareTitle="+title+"&shareText="+desc+"&shareUrl="+link+"&shareImageUrl="+imgUrl);if(easybuy.isWechat){var tokenInfo=getToken();tokenInfo&&tokenInfo.token&&tokenInfo.openId?$scope.fadeInShare():$location.path("/wechatOauth/activity-activityDetail")}else{var arrButton=["确定"];openDialog("请在微信内打开并分享到朋友圈","",arrButton,null,function(r){})}},$scope.shareSuccess=function(){},$scope.back=function(){$location.path("/products")},$scope.fadeOutShare=function(){$("#shareHint").fadeOut()},$scope.fadeInShare=function(){$("#shareHint").fadeIn()},$location.search()){var actId="";actId=$location.search().activityId instanceof Array?$location.search().activityId[0]:$location.search().activityId;var data="platform=all&activityId="+actId;httpRequest.APIPOST("/activity/detail",dataStringify(data),{"content-type":"application/x-www-form-urlencoded"}).then(function(result){if(result&&result.code==statusCode.Success){if($scope.activityInfo=result.result,null==result.result)return void alertExt("该活动已结束，更多精彩活动尽在首页！",function(){$location.path("/"),$scope.$apply($location)});var act=$scope.activityInfo.activity;act.url||(act.url=""),link=act.url.indexOf("?")>0?act.url+"&activityId="+act.id+"&source=3&sharedTo=":act.url+"?activityId="+act.id+"&source=3&sharedTo=",imgUrl=act.img,title=act.name,desc=act.desc,$scope.products=[],$scope.activityInfo&&$scope.activityInfo.fullGiveGoodsList&&($scope.products=$scope.activityInfo.fullGiveGoodsList)}else alert(result.msg+":activity-detail")})}if($location.search()&&$location.search().sharedTo&&$location.search().source){var actId=($location.search(),""),channel=$location.search().sharedTo||1;channel instanceof Array&&(channel=1);{var platform=$location.search().source||"all";$location.search().pageType||""}platform=1==platform?"android":2==platform?"ios":"all",actId=$location.search().activityId instanceof Array?$location.search().activityId[0]:$location.search().activityId;var token="";getToken()&&(token="&token="+getToken().token);var data="activityId="+actId+"&channel="+channel+"&platform="+platform+token;httpRequest.APIPOST("/activity/clickLog",dataStringify(data),{"content-type":"application/x-www-form-urlencoded"}).then(function(result){result&&result.code==statusCode.Success})}else{var platform=$location.search().platform||"all",token=$location.search().token||"",actId="";actId=$location.search().activityId instanceof Array?$location.search().activityId[0]:$location.search().activityId,token?token="&token="+token:getToken()&&(token="&token="+getToken().token);var data="activityId="+actId+"&type=2&platform="+platform+token;httpRequest.APIPOST("/activity/clickLog",dataStringify(data),{"content-type":"application/x-www-form-urlencoded"}).then(function(result){result&&result.code==statusCode.Success})}});